import { router, Tabs } from "expo-router";
import React, { useEffect } from "react";
import { Platform, View } from "react-native";

import { HapticTab } from "@/components/HapticTab";
import TabBarBackground from "@/components/ui/TabBarBackground";
import { Colors } from "@/constants/Colors";
import { useColorScheme } from "@/hooks/useColorScheme";
import { Path, Svg } from "react-native-svg";
import AsyncStorage from "@react-native-async-storage/async-storage";


useEffect(() => {
  const initializeAuth = async () => {
    const storedToken = await AsyncStorage.getItem("userToken");
    if (storedToken) {
      router.replace("/(tabs)");
    } else {
      router.replace("/auth/login");
    }
  };

  initializeAuth();
}, []);

export default function TabLayout() {
  const colorScheme = useColorScheme();

  return (
    <Tabs
      screenOptions={{
        tabBarActiveTintColor: Colors[colorScheme ?? "light"].tint,
        headerShown: false,
        tabBarButton: HapticTab,
        tabBarBackground: TabBarBackground,
        tabBarStyle: Platform.select({
          ios: {
            position: "absolute",
          },
          default: {},
        }),
      }}
    >
      <Tabs.Screen
        name="index"
        options={{
          tabBarIcon: ({ focused }) => (
            <View
              style={{
                width: 36,
                height: 36,
                borderRadius: 18,
                backgroundColor: focused ? "#CACACA" : "transparent",
                alignItems: "center",
                justifyContent: "center",
              }}
            >
              <Svg width="30" height="30" viewBox="0 0 30 30" fill="none">
                <Path
                  d="M25.3125 12.5C25.3125 12.2948 25.2721 12.0916 25.1936 11.902C25.115 11.7125 24.9999 11.5402 24.8549 11.3951C24.7098 11.25 24.5375 11.1349 24.3479 11.0564C24.1584 10.9779 23.9552 10.9375 23.75 10.9375C23.5448 10.9375 23.3416 10.9779 23.1521 11.0564C22.9625 11.1349 22.7902 11.25 22.6451 11.3951C22.5 11.5402 22.385 11.7125 22.3064 11.902C22.2279 12.0916 22.1875 12.2948 22.1875 12.5H25.3125ZM7.8125 12.5C7.8125 12.0856 7.64788 11.6882 7.35485 11.3951C7.06183 11.1021 6.6644 10.9375 6.25 10.9375C5.8356 10.9375 5.43817 11.1021 5.14515 11.3951C4.85212 11.6882 4.6875 12.0856 4.6875 12.5H7.8125ZM25.145 16.105C25.4381 16.398 25.8355 16.5627 26.25 16.5627C26.6645 16.5627 27.0619 16.398 27.355 16.105C27.6481 15.8119 27.8127 15.4144 27.8127 15C27.8127 14.5855 27.6481 14.1881 27.355 13.895L25.145 16.105ZM15 3.74999L16.105 2.64499C15.9599 2.49985 15.7876 2.38472 15.598 2.30617C15.4084 2.22762 15.2052 2.18719 15 2.18719C14.7948 2.18719 14.5916 2.22762 14.402 2.30617C14.2124 2.38472 14.0401 2.49985 13.895 2.64499L15 3.74999ZM2.645 13.895C2.35194 14.1881 2.18729 14.5855 2.18729 15C2.18729 15.4144 2.35194 15.8119 2.645 16.105C2.93806 16.398 3.33554 16.5627 3.75 16.5627C4.16446 16.5627 4.56194 16.398 4.855 16.105L2.645 13.895ZM8.75 27.8125H21.25V24.6875H8.75V27.8125ZM25.3125 23.75V12.5H22.1875V23.75H25.3125ZM7.8125 23.75V12.5H4.6875V23.75H7.8125ZM27.355 13.895L16.105 2.64499L13.895 4.85499L25.145 16.105L27.355 13.895ZM13.895 2.64499L2.645 13.895L4.855 16.105L16.105 4.85499L13.895 2.64499ZM21.25 27.8125C22.3274 27.8125 23.3608 27.3845 24.1226 26.6226C24.8845 25.8607 25.3125 24.8274 25.3125 23.75H22.1875C22.1875 23.9986 22.0887 24.2371 21.9129 24.4129C21.7371 24.5887 21.4986 24.6875 21.25 24.6875V27.8125ZM8.75 24.6875C8.50136 24.6875 8.2629 24.5887 8.08709 24.4129C7.91127 24.2371 7.8125 23.9986 7.8125 23.75H4.6875C4.6875 24.8274 5.11551 25.8607 5.87738 26.6226C6.63924 27.3845 7.67256 27.8125 8.75 27.8125V24.6875Z"
                  fill="#000"
                />
              </Svg>
            </View>
          ),
          tabBarShowLabel: false,
        }}
      />

      <Tabs.Screen
        name="addItem"
        options={{
          tabBarIcon: ({ focused }) => (
            <View
              style={{
                width: 36,
                height: 36,
                borderRadius: 18,
                backgroundColor: focused ? "#CACACA" : "transparent",
                alignItems: "center",
                justifyContent: "center",
              }}
            >
              <Svg width="30" height="30" viewBox="0 0 30 30" fill="none">
                <Path
                  d="M15 28.125C7.7625 28.125 1.875 22.2375 1.875 15C1.875 7.7625 7.7625 1.875 15 1.875C22.2375 1.875 28.125 7.7625 28.125 15C28.125 22.2375 22.2375 28.125 15 28.125ZM15 3.75C8.79375 3.75 3.75 8.79375 3.75 15C3.75 21.2062 8.79375 26.25 15 26.25C21.2062 26.25 26.25 21.2062 26.25 15C26.25 8.79375 21.2062 3.75 15 3.75Z"
                  fill="#000"
                />
                <Path
                  d="M15 21.5625C14.475 21.5625 14.0625 21.15 14.0625 20.625V9.375C14.0625 8.85 14.475 8.4375 15 8.4375C15.525 8.4375 15.9375 8.85 15.9375 9.375V20.625C15.9375 21.15 15.525 21.5625 15 21.5625Z"
                  fill="#000"
                />
                <Path
                  d="M20.625 15.9375H9.375C8.85 15.9375 8.4375 15.525 8.4375 15C8.4375 14.475 8.85 14.0625 9.375 14.0625H20.625C21.15 14.0625 21.5625 14.475 21.5625 15C21.5625 15.525 21.15 15.9375 20.625 15.9375Z"
                  fill="#000"
                />
              </Svg>
            </View>
          ),
          tabBarShowLabel: false,
        }}
      />
      <Tabs.Screen
        name="generate"
        options={{
          tabBarIcon: ({ focused }) => (
            <View
              style={{
                width: 36,
                height: 36,
                borderRadius: 18,
                backgroundColor: focused ? "#CACACA" : "transparent",
                alignItems: "center",
                justifyContent: "center",
              }}
            >
              <Svg width="30" height="30" viewBox="0 0 30 30" fill="none">
                <Path
                  d="M11.3838 6.81C12.1313 4.6225 15.1538 4.55625 16.04 6.61125L16.115 6.81125L17.1238 9.76125C17.3549 10.4378 17.7285 11.0569 18.2193 11.5768C18.7101 12.0967 19.3066 12.5053 19.9688 12.775L20.24 12.8762L23.19 13.8838C25.3775 14.6313 25.4438 17.6537 23.39 18.54L23.19 18.615L20.24 19.6238C19.5632 19.8548 18.9439 20.2283 18.4238 20.7191C17.9037 21.2099 17.4949 21.8065 17.225 22.4688L17.1238 22.7388L16.1163 25.69C15.3688 27.8775 12.3463 27.9438 11.4613 25.89L11.3838 25.69L10.3763 22.74C10.1452 22.0632 9.77172 21.4439 9.28093 20.9238C8.79015 20.4037 8.1935 19.9949 7.53126 19.725L7.26126 19.6238L4.31126 18.6162C2.12251 17.8687 2.05626 14.8462 4.11126 13.9612L4.31126 13.8838L7.26126 12.8762C7.9378 12.6451 8.5569 12.2715 9.07679 11.7807C9.59668 11.2899 10.0053 10.6934 10.275 10.0312L10.3763 9.76125L11.3838 6.81ZM13.75 7.6175L12.7425 10.5675C12.3905 11.5991 11.8178 12.5416 11.0644 13.3294C10.311 14.1171 9.39494 14.7312 8.38001 15.1287L8.06751 15.2425L5.11751 16.25L8.06751 17.2575C9.09914 17.6095 10.0416 18.1822 10.8294 18.9356C11.6171 19.689 12.2312 20.6051 12.6288 21.62L12.7425 21.9325L13.75 24.8825L14.7575 21.9325C15.1095 20.9009 15.6822 19.9584 16.4356 19.1706C17.189 18.3829 18.1051 17.7688 19.12 17.3713L19.4325 17.2587L22.3825 16.25L19.4325 15.2425C18.4009 14.8905 17.4584 14.3178 16.6706 13.5644C15.8829 12.811 15.2689 11.8949 14.8713 10.88L14.7588 10.5675L13.75 7.6175ZM23.75 2.5C23.9839 2.5 24.213 2.5656 24.4114 2.68934C24.6099 2.81308 24.7696 2.99 24.8725 3.2L24.9325 3.34625L25.37 4.62875L26.6538 5.06625C26.8881 5.14587 27.0935 5.29327 27.244 5.48977C27.3945 5.68627 27.4833 5.92302 27.4991 6.17003C27.5149 6.41703 27.457 6.66316 27.3328 6.87723C27.2085 7.0913 27.0236 7.26367 26.8013 7.3725L26.6538 7.4325L25.3713 7.87L24.9338 9.15375C24.854 9.38804 24.7065 9.59337 24.5099 9.74374C24.3133 9.89411 24.0766 9.98274 23.8296 9.9984C23.5826 10.0141 23.3365 9.95606 23.1225 9.83172C22.9085 9.70739 22.7362 9.52233 22.6275 9.3L22.5675 9.15375L22.13 7.87125L20.8463 7.43375C20.6119 7.35413 20.4065 7.20673 20.256 7.01023C20.1055 6.81373 20.0167 6.57698 20.0009 6.32997C19.9851 6.08297 20.043 5.83684 20.1672 5.62277C20.2915 5.4087 20.4765 5.23633 20.6988 5.1275L20.8463 5.0675L22.1288 4.63L22.5663 3.34625C22.6505 3.09928 22.81 2.88489 23.0223 2.73312C23.2346 2.58136 23.4891 2.49984 23.75 2.5Z"
                  fill="#000"
                />
              </Svg>
            </View>
          ),
          tabBarShowLabel: false,
        }}
      />
      <Tabs.Screen
        name="library"
        options={{
          tabBarIcon: ({ focused }) => (
            <View
              style={{
                width: 36,
                height: 36,
                borderRadius: 18,
                backgroundColor: focused ? "#CACACA" : "transparent",
                alignItems: "center",
                justifyContent: "center",
              }}
            >
              <Svg width="30" height="30" viewBox="0 0 30 30" fill="none">
                <Path
                  d="M24.4525 8.75C24.5196 8.36692 24.5021 7.97379 24.4012 7.59821C24.3002 7.22262 24.1183 6.87369 23.8681 6.57589C23.618 6.2781 23.3057 6.03866 22.9531 5.87439C22.6006 5.71012 22.2164 5.625 21.8275 5.625H8.17251C7.78359 5.625 7.39939 5.71012 7.04687 5.87439C6.69435 6.03866 6.38205 6.2781 6.1319 6.57589C5.88176 6.87369 5.69982 7.22262 5.59886 7.59821C5.49791 7.97379 5.48038 8.36692 5.54751 8.75M21.875 5.625C21.91 5.3 21.9288 5.13875 21.9288 5.005C21.9301 4.38712 21.7026 3.79062 21.2901 3.33058C20.8776 2.87054 20.3094 2.57955 19.695 2.51375C19.5625 2.5 19.4 2.5 19.075 2.5H10.925C10.6 2.5 10.4363 2.5 10.3038 2.51375C9.68939 2.57955 9.12115 2.87054 8.70866 3.33058C8.29617 3.79062 8.06866 4.38712 8.07001 5.005C8.07001 5.13875 8.08751 5.30125 8.12376 5.625"
                  stroke="#000"
                  strokeWidth="1.5"
                />
                <Path
                  d="M18.75 22.5H11.25"
                  stroke="#000"
                  strokeWidth="1.5"
                  strokeLinecap="round"
                />
                <Path
                  d="M2.98001 17.2413C2.42126 13.2863 2.14251 11.31 3.32751 10.0287C4.51251 8.75 6.62251 8.75 10.84 8.75H19.16C23.3775 8.75 25.4875 8.75 26.6725 10.03C27.8575 11.31 27.5775 13.2863 27.02 17.2413L26.4925 20.9912C26.055 24.0912 25.8363 25.6425 24.715 26.5712C23.5938 27.5 21.94 27.5 18.6313 27.5H11.3688C8.06127 27.5 6.40627 27.5 5.28502 26.5712C4.16377 25.6425 3.94501 24.0925 3.50751 20.9912L2.98001 17.2413Z"
                  stroke="#000"
                  strokeWidth="1.5"
                />
              </Svg>
            </View>
          ),
          tabBarShowLabel: false,
        }}
      />
    </Tabs>
  );
}
